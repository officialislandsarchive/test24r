<!DOCTYPE html>
<html>
<head>
  <title>Retrieve UUIDs</title>
</head>
<body>
  <h1>Retrieve BLE UUIDs</h1>
  <button id="connectBtn">Connect to Device</button>
  <div id="status"></div>
  <ul id="uuidList"></ul> <!-- List to display UUIDs -->

  <script>
    function updateStatus(message) {
      document.getElementById("status").innerText = message;
      console.log(message);
    }

    document.getElementById("connectBtn").addEventListener("click", async () => {
      try {
        updateStatus("Requesting Bluetooth device...");
        const device = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true,
          optionalServices: [] // No UUIDs specified for discovery
        });

        updateStatus(`Connected to ${device.name}`);
        const server = await device.gatt.connect();
        updateStatus("Connected to GATT server. Retrieving services...");

        const services = await server.getPrimaryServices();
        const uuidList = document.getElementById("uuidList");
        uuidList.innerHTML = "";

        for (const service of services) {
          const serviceUUID = service.uuid;
          const serviceItem = document.createElement("li");
          serviceItem.textContent = `Service UUID: ${serviceUUID}`;
          uuidList.appendChild(serviceItem);
          console.log(`Service UUID: ${serviceUUID}`);

          const characteristics = await service.getCharacteristics();
          for (const characteristic of characteristics) {
            const charUUID = characteristic.uuid;
            const charItem = document.createElement("li");
            charItem.style.marginLeft = "20px";
            charItem.textContent = `Characteristic UUID: ${charUUID}`;
            uuidList.appendChild(charItem);
            console.log(`Characteristic UUID: ${charUUID}`);
          }
        }

        updateStatus("UUIDs retrieved successfully.");
      } catch (error) {
        updateStatus("Error retrieving UUIDs. Make sure the Bluetooth device is nearby and Bluetooth is enabled.");
        console.error(error);
      }
    });
  </script>
</body>
</html>
